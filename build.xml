<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." name="Diagnostics" default="all">
    
    <description>
        diagnostics/build.xml
        
        ANT FILE FOR TEI PROJECT DIAGNOSTICS.
        
        See diagnostics/README.txt for instructions
        on how to run this diagnostics suite.
        
        Note that this assume oXygen version 17.0 or
        higher. 
        [[Other descriptive things go here]]
    </description>
    
    

    <path id="jars">
        <pathelement path="utilities"/>
        <pathelement location="utilities/saxon9he.jar"/>
    </path>
    
    
    
<!--    First, if this is a file or a directory-->
<!--    Then strip things away as necessary-->
    
    <!--    user.projectDirectory is an custom editor variable -->
    
    <pathconvert property="projectDirectory">
        <path>
            <pathelement location="${user.projectDirectory}"/>
        </path>
        <mapper type="regexp" from="^(.*:)?(.*)(/|/.*\.[a-zA-Z]+)?^" to="\2/"/>
    </pathconvert>
    
    <!--<available  property="dirExists" file="${projectDirectory}" type="dir" searchparents="false"/>-->
    
   
   
    
    
    
    <target name="setup">
        <description>
            task: setup
            
            This task creates a diagnostics directory in the projectFolder.
        </description>
        <echo message="Input: ${user.projectDirectory}"/>
        <echo message="After regex: ${projectDirectory}"/>
    </target>

    
    <target name="runDiagnostics">
        <description>
            task: runDiagnostics
            
            This task runs the diagnostics suite
        </description>
        
        <echo message="${echo.separator}"/>
        <echo message="Creating diagnostics output for project: ${projectDirectory}"/>
        <java classname="net.sf.saxon.Transform" classpath="utilities/saxon9he.jar">
            <arg value="-s:xsl/diagnostics_master.xsl"/>
            <arg value="-xsl:xsl/diagnostics_master.xsl"/> 
            <arg value="projectDirectory=${projectDirectory}"/>
            <arg value="--suppressXsltNamespaceCheck:on"/>
        </java>
    </target>
    
    
    <target name="all">
        <description>
            TARGET: all
            This target is the default and runs all the build processes.
        </description>
        <antcall target="setup"/>
        <antcall target="runDiagnostics"/>
    </target>
</project>